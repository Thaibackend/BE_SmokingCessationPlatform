### TEST ADMIN CREATE PACKAGE - DEBUG MODE
### Debug cÃ¡c váº¥n Ä‘á» cÃ³ thá»ƒ xáº£y ra khi Admin táº¡o package

@baseUrl = https://localhost:7147/api
@adminToken = Bearer YOUR_ADMIN_JWT_TOKEN_HERE

### ================================================================
### BÆ¯á»šC 1: Táº O VÃ€ ÄÄ‚NG NHáº¬P ADMIN
### ================================================================

### 1.1 ÄÄƒng kÃ½ Admin (náº¿u chÆ°a cÃ³)
POST {{baseUrl}}/Auth/register
Content-Type: application/json

{
  "username": "admin001",
  "email": "admin@smokequit.com",
  "password": "admin123",
  "fullName": "System Administrator",
  "phoneNumber": "0900000001",
  "dateOfBirth": "1985-01-01T00:00:00.000Z",
  "cigarettesPerDay": 0,
  "yearsOfSmoking": 0
}

### 1.2 ÄÄƒng nháº­p Admin
POST {{baseUrl}}/Auth/login
Content-Type: application/json

{
  "email": "admin@smokequit.com",
  "password": "admin123"
}
# ðŸ’¡ Copy JWT token vÃ  paste vÃ o @adminToken

### ================================================================
### BÆ¯á»šC 2: KIá»‚M TRA ROLE VÃ€ ACCESS
### ================================================================

### 2.1 Kiá»ƒm tra cÃ³ thá»ƒ access Admin APIs khÃ´ng
GET {{baseUrl}}/Admin/statistics
Authorization: {{adminToken}}

### 2.2 Xem packages hiá»‡n táº¡i
GET {{baseUrl}}/Admin/packages
Authorization: {{adminToken}}

### ================================================================
### BÆ¯á»šC 3: TEST Táº O PACKAGE Vá»šI CÃC SCENARIO
### ================================================================

### 3.1 Test táº¡o package THÃ€NH CÃ”NG (Complete data)
POST {{baseUrl}}/Admin/packages
Authorization: {{adminToken}}
Content-Type: application/json

{
  "name": "Test Premium Package",
  "description": "GÃ³i Premium test vá»›i Ä‘áº§y Ä‘á»§ tÃ­nh nÄƒng",
  "price": 199000,
  "durationDays": 30,
  "features": "Coach cÃ¡ nhÃ¢n, Chat khÃ´ng giá»›i háº¡n, Meeting 1:1, Progress tracking chi tiáº¿t",
  "isActive": true
}

### 3.2 Test táº¡o package BASIC
POST {{baseUrl}}/Admin/packages
Authorization: {{adminToken}}
Content-Type: application/json

{
  "name": "Basic Package",
  "description": "GÃ³i cÆ¡ báº£n cho ngÆ°á»i má»›i báº¯t Ä‘áº§u",
  "price": 0,
  "durationDays": 30,
  "features": "Progress tracking cÆ¡ báº£n, Community access",
  "isActive": true
}

### 3.3 Test táº¡o package vá»›i GIÃ CAO
POST {{baseUrl}}/Admin/packages
Authorization: {{adminToken}}
Content-Type: application/json

{
  "name": "VIP Package",
  "description": "GÃ³i VIP vá»›i coach chuyÃªn gia",
  "price": 999000,
  "durationDays": 90,
  "features": "Coach chuyÃªn gia, Meeting daily, Progress analysis, Personal plan",
  "isActive": true
}

### ================================================================
### BÆ¯á»šC 4: TEST CÃC ERROR CASES
### ================================================================

### 4.1 Test KHÃ”NG CÃ“ TOKEN
POST {{baseUrl}}/Admin/packages
Content-Type: application/json

{
  "name": "No Auth Package",
  "description": "Test khÃ´ng cÃ³ auth",
  "price": 100000,
  "durationDays": 30,
  "features": "Test",
  "isActive": true
}
# Expected: 401 Unauthorized

### 4.2 Test TOKEN KHÃ”NG PHáº¢I ADMIN (dÃ¹ng user token)
POST {{baseUrl}}/Admin/packages
Authorization: Bearer USER_TOKEN_HERE
Content-Type: application/json

{
  "name": "User Try Package",
  "description": "User thá»­ táº¡o package",
  "price": 100000,
  "durationDays": 30,
  "features": "Test",
  "isActive": true
}
# Expected: 403 Forbidden

### 4.3 Test DATA THIáº¾U (Name)
POST {{baseUrl}}/Admin/packages
Authorization: {{adminToken}}
Content-Type: application/json

{
  "description": "Package thiáº¿u name",
  "price": 100000,
  "durationDays": 30,
  "features": "Test",
  "isActive": true
}
# Expected: 400 Bad Request

### 4.4 Test DATA THIáº¾U (Price)
POST {{baseUrl}}/Admin/packages
Authorization: {{adminToken}}
Content-Type: application/json

{
  "name": "No Price Package",
  "description": "Package thiáº¿u price",
  "durationDays": 30,
  "features": "Test",
  "isActive": true
}
# Expected: 400 Bad Request

### 4.5 Test DATA THIáº¾U (DurationDays)
POST {{baseUrl}}/Admin/packages
Authorization: {{adminToken}}
Content-Type: application/json

{
  "name": "No Duration Package",
  "description": "Package thiáº¿u duration",
  "price": 100000,
  "features": "Test",
  "isActive": true
}
# Expected: 400 Bad Request

### 4.6 Test NAME QUÃ DÃ€I (>200 chars)
POST {{baseUrl}}/Admin/packages
Authorization: {{adminToken}}
Content-Type: application/json

{
  "name": "Package Name Ráº¥t DÃ i QuÃ¡ 200 KÃ½ Tá»± Äá»ƒ Test Validation Database Constraint Xem CÃ³ Bá»‹ Lá»—i Hay KhÃ´ng VÃ¬ Trong Model MemberPackage StringLength Attribute Giá»›i Háº¡n 200 Characters Cho Name Field NÃªn Cáº§n Test Case NÃ y",
  "description": "Test name quÃ¡ dÃ i",
  "price": 100000,
  "durationDays": 30,
  "features": "Test",
  "isActive": true
}
# Expected: 400 Bad Request hoáº·c DB error

### 4.7 Test PRICE Ã‚M
POST {{baseUrl}}/Admin/packages
Authorization: {{adminToken}}
Content-Type: application/json

{
  "name": "Negative Price Package",
  "description": "Package vá»›i giÃ¡ Ã¢m",
  "price": -100000,
  "durationDays": 30,
  "features": "Test",
  "isActive": true
}
# Expected: CÃ³ thá»ƒ pass hoáº·c validation error

### 4.8 Test DURATION Ã‚M
POST {{baseUrl}}/Admin/packages
Authorization: {{adminToken}}
Content-Type: application/json

{
  "name": "Negative Duration Package",
  "description": "Package vá»›i duration Ã¢m",
  "price": 100000,
  "durationDays": -30,
  "features": "Test",
  "isActive": true
}
# Expected: CÃ³ thá»ƒ pass hoáº·c validation error

### ================================================================
### BÆ¯á»šC 5: DEBUG DATABASE CONNECTION
### ================================================================

### 5.1 Kiá»ƒm tra Admin statistics (test DB connection)
GET {{baseUrl}}/Admin/statistics
Authorization: {{adminToken}}

### 5.2 Xem all accounts (test DB read)
GET {{baseUrl}}/Admin/accounts
Authorization: {{adminToken}}

### 5.3 Thá»­ táº¡o coach (test DB write khÃ¡c)
POST {{baseUrl}}/Admin/coaches
Authorization: {{adminToken}}
Content-Type: application/json

{
  "username": "testcoach",
  "email": "testcoach@example.com",
  "password": "coach123",
  "fullName": "Test Coach",
  "phone": "0900000002",
  "specialization": "Smoking Cessation",
  "bio": "Coach chuyÃªn há»— trá»£ cai thuá»‘c lÃ¡"
}

### ================================================================
### EXPECTED RESULTS & TROUBLESHOOTING
### ================================================================

# âœ… THÃ€NH CÃ”NG:
# - Status: 200 OK
# - Response: { "message": "Táº¡o package thÃ nh cÃ´ng", "packageId": X, "name": "..." }

# âŒ CÃC Lá»–I CÃ“ THá»‚:
# 
# 1. 401 Unauthorized:
#    - KhÃ´ng cÃ³ token hoáº·c token invalid
#    - Solution: ÄÄƒng nháº­p láº¡i, copy token má»›i
#
# 2. 403 Forbidden: 
#    - Token khÃ´ng pháº£i Admin role
#    - Solution: Äáº£m báº£o account cÃ³ role Admin
#
# 3. 400 Bad Request - Model validation:
#    - Name/Price/DurationDays required bá»‹ thiáº¿u
#    - Name > 200 characters
#    - Solution: Kiá»ƒm tra data input
#
# 4. 500 Internal Server Error - Database:
#    - Lá»—i "entity changes" = Database connection issue
#    - Foreign key constraint violation (CreatedById = 1 khÃ´ng tá»“n táº¡i)
#    - Solution: Check database, táº¡o Admin account vá»›i ID = 1

### ================================================================
### SOLUTION CHO Lá»–I "entity changes"
### ================================================================

# NguyÃªn nhÃ¢n cÃ³ thá»ƒ:
# 1. CreatedById = 1 khÃ´ng tá»“n táº¡i trong Accounts table
# 2. Database connection string sai
# 3. Migration chÆ°a cháº¡y Ä‘áº§y Ä‘á»§

# CÃ¡ch fix:
# 1. Táº¡o Admin account vá»›i ID = 1 trÆ°á»›c
# 2. Hoáº·c thay CreatedById = actual admin ID
# 3. Kiá»ƒm tra connection string trong appsettings.json 