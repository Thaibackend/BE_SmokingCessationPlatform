### QUICK TEST: UPGRADE TO PREMIUM - SMOKING QUIT SUPPORT API
### H∆∞·ªõng d·∫´n test nhanh upgrade Premium m√† kh√¥ng c·∫ßn VNPay th·∫≠t

@baseUrl = https://localhost:7147/api
@token = Bearer YOUR_JWT_TOKEN_HERE

### ================================================================
### B∆Ø·ªöC 1: ƒêƒÇNG NH·∫¨P (ho·∫∑c ƒëƒÉng k√Ω user m·ªõi)
### ================================================================

### 1.1. ƒêƒÉng k√Ω user m·ªõi (n·∫øu ch∆∞a c√≥)
POST {{baseUrl}}/Auth/register
Content-Type: application/json

{
  "username": "testuser123",
  "email": "test@example.com",
  "password": "password123",
  "fullName": "Nguyen Van Test",
  "phoneNumber": "0912345678",
  "dateOfBirth": "1990-01-01T00:00:00.000Z",
  "cigarettesPerDay": 10,
  "yearsOfSmoking": 5
}

### 1.2. ƒêƒÉng nh·∫≠p v√† copy JWT token
POST {{baseUrl}}/Auth/login
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "password123"
}

### ‚ö†Ô∏è QUAN TR·ªåNG: Copy JWT token t·ª´ response v√† paste v√†o @token ·ªü ƒë·∫ßu file

### ================================================================
### B∆Ø·ªöC 2: KI·ªÇM TRA PACKAGE HI·ªÜN T·∫†I
### ================================================================

### 2.1. Xem package hi·ªán t·∫°i (s·∫Ω l√† BASIC)
GET {{baseUrl}}/Package/my-package
Authorization: {{token}}

### ================================================================
### B∆Ø·ªöC 3: UPGRADE L√äN PREMIUM
### ================================================================

### 3.1. Upgrade v·ªõi payment method b·∫•t k·ª≥
POST {{baseUrl}}/Package/upgrade
Authorization: {{token}}
Content-Type: application/json

{
  "targetPackageType": "PREMIUM",
  "newPackageType": "PREMIUM", 
  "price": 299000,
  "durationDays": 30,
  "paymentMethod": "VNPAY",
  "paymentReference": "TEST_REF_123"
}

### üìù Copy transactionId t·ª´ response tr√™n (v√≠ d·ª•: VP000001202412251649)
@transactionId = VP000001202412251649

### ================================================================
### B∆Ø·ªöC 4: FAKE THANH TO√ÅN TH√ÄNH C√îNG (MANUAL VERIFICATION)
### ================================================================

### 4.1. Gi·∫£ l·∫≠p thanh to√°n th√†nh c√¥ng
POST {{baseUrl}}/Package/verify-payment/{{transactionId}}
Authorization: {{token}}
Content-Type: application/json

{
  "transactionId": "{{transactionId}}",
  "paymentMethod": "VNPAY",
  "amount": 299000,
  "status": "PAID",
  "verificationDate": "2024-12-25T16:49:00.000Z",
  "verificationNotes": "FAKE PAYMENT FOR TESTING - Admin verified"
}

### ================================================================
### B∆Ø·ªöC 5: KI·ªÇM TRA PREMIUM ƒê√É ƒê∆Ø·ª¢C K√çCH HO·∫†T
### ================================================================

### 5.1. Xem package sau khi upgrade
GET {{baseUrl}}/Package/my-package
Authorization: {{token}}

### K·∫øt qu·∫£ mong ƒë·ª£i:
### - packageType: "PREMIUM"
### - status: "ACTIVE" 
### - isPremium: true
### - daysRemaining: 30

### ================================================================
### B∆Ø·ªöC 6: TEST PREMIUM FEATURES - COACH BOOKING
### ================================================================

### 6.1. Xem danh s√°ch coaches available
GET {{baseUrl}}/Premium/coach/available-coaches
Authorization: {{token}}

### 6.2. Ch·ªçn coach ƒë·∫ßu ti√™n (thay 1 b·∫±ng coachId th·∫≠t)
POST {{baseUrl}}/Premium/coach/assign/1
Authorization: {{token}}

### 6.3. Xem coach ƒë√£ ƒë∆∞·ª£c assign
GET {{baseUrl}}/Premium/coach/my-coach
Authorization: {{token}}

### 6.4. Book meeting v·ªõi coach
POST {{baseUrl}}/Premium/meeting/book
Authorization: {{token}}
Content-Type: application/json

{
  "preferredDate": "2024-12-30T10:00:00.000Z",
  "meetingType": "INITIAL_CONSULTATION",
  "notes": "Test booking sau khi upgrade Premium"
}

### 6.5. Xem meetings ƒë√£ book
GET {{baseUrl}}/Premium/meeting/my-meetings
Authorization: {{token}}

### 6.6. Chat v·ªõi coach
POST {{baseUrl}}/Premium/chat/send
Authorization: {{token}}
Content-Type: application/json

{
  "receiverId": 2,
  "content": "Ch√†o coach, t√¥i v·ª´a upgrade Premium v√† mu·ªën ƒë∆∞·ª£c t∆∞ v·∫•n",
  "messageType": "TEXT"
}

### ================================================================
### ADMIN VERIFICATION (N·∫øu c·∫ßn)
### ================================================================

### 7.1. Admin xem user statistics
GET {{baseUrl}}/Admin/statistics/users
Authorization: {{token}}

### 7.2. Admin xem revenue
GET {{baseUrl}}/Admin/statistics/revenue
Authorization: {{token}}

### ================================================================
### ‚úÖ TH√ÄNH C√îNG! 
### ================================================================

# N·∫øu t·∫•t c·∫£ c√°c b∆∞·ªõc tr√™n ƒë·ªÅu return success (200 OK), 
# nghƒ©a l√† user ƒë√£:
# 1. ‚úÖ Upgrade l√™n Premium th√†nh c√¥ng
# 2. ‚úÖ C√≥ th·ªÉ ch·ªçn coach
# 3. ‚úÖ Book meeting ƒë∆∞·ª£c
# 4. ‚úÖ Chat v·ªõi coach ƒë∆∞·ª£c
# 5. ‚úÖ S·ª≠ d·ª•ng ƒë·∫ßy ƒë·ªß Premium features

### ================================================================
### TROUBLESHOOTING
### ================================================================

### N·∫øu l·ªói "Invalid token":
# - ƒêƒÉng nh·∫≠p l·∫°i v√† copy token m·ªõi
# - Ki·ªÉm tra token c√≥ "Bearer " ·ªü ƒë·∫ßu

### N·∫øu l·ªói "B·∫°n c·∫ßn g√≥i Premium":
# - Ki·ªÉm tra payment verification ƒë√£ th√†nh c√¥ng ch∆∞a
# - Xem l·∫°i package status c√≥ ACTIVE kh√¥ng

### N·∫øu l·ªói "Coach kh√¥ng t·ªìn t·∫°i":
# - T·∫°o coach m·ªõi qua Admin API
# - Ho·∫∑c d√πng coachId kh√°c

### N·∫øu kh√¥ng c√≥ coach n√†o:
# Admin t·∫°o coach m·ªõi:
POST {{baseUrl}}/Admin/coaches
Authorization: {{token}}
Content-Type: application/json

{
  "username": "coach.test",
  "email": "coach@example.com",
  "password": "coach123",
  "fullName": "Dr. Test Coach",
  "qualifications": "PhD Psychology",
  "experience": "5 years",
  "bio": "Test coach for development"
} 